<div class="timeline-grid-container">
  <!-- Left Panel: Work Centers -->
  <div class="work-centers-panel">
    <div class="work-center-header">Work Center</div>
    @for (workCenter of workCenters; track trackByWorkCenter(workCenter)) {
      <div class="work-center-row">
        <div class="work-center-name">{{ workCenter }}</div>
      </div>
    }
  </div>

  <!-- Right Panel: Timeline Grid (Scrollable) -->
  <div class="timeline-panel" #timelinePanel (scroll)="onScroll()">
    <!-- Timeline Header -->
    <div class="timeline-header">
      @for (date of dateHeaders(); track trackByDate(date); let i = $index) {
        <div class="timeline-month-header" [class.current-month]="isCurrentPeriod(date)" [style.width.px]="getCellWidth()">
          <div class="month-name">{{ formatDateHeader(date) }}</div>
        </div>
      }
    </div>

    <!-- Timeline Rows -->
    @for (workCenter of workCenters; track workCenter; let i = $index) {
      <div 
        class="timeline-row"
        [class.first-row]="i === 0"
        [class.row-hovered]="hoveredRowIndex() === i"
        [style.width.px]="containerWidth()"
        (click)="onRowClick($event, workCenter)"
      >
        <!-- Timeline cells -->
        @for (date of dateHeaders(); track trackByDate(date); let j = $index) {
          <div 
            class="timeline-cell"
            [class.current-period]="j === getCurrentPeriodIndex()"
            [class.cell-hovered]="hoveredRowIndex() === i && hoveredCellIndex() === j"
            [style.width.px]="getCellWidth()"
            (mouseenter)="onCellMouseEnter($event, i, j)"
            (mouseleave)="onCellMouseLeave()"
          >
            <!-- Vertical line -->
            <div 
              class="vertical-line"
              [class.current-month]="j === getCurrentPeriodIndex()"
            ></div>
            
            <!-- Hover tooltip -->
            @if (hoveredRowIndex() === i && hoveredCellIndex() === j) {
              <div class="cell-hover-overlay">
                <app-nao-tooltip text="Click to add dates" trigger="hover" position="top">
                  <div class="cell-hover-content">&nbsp;</div>
                </app-nao-tooltip>
              </div>
            }
          </div>
        }
        
        <!-- Current period label -->
        @if (i === 0) {
          @if (getCurrentPeriodIndex() >= 0) {
            <div class="current-month-label" [style.left.px]="getCurrentPeriodIndex() * getCellWidth() + 8">
              @if (currentZoom() === 'day') {
                Today
              } @else if (currentZoom() === 'week') {
                Current week
              } @else {
                Current month
              }
            </div>
          }
        }
        
        <!-- Work order bars for this work center -->
        @for (workOrder of getWorkOrdersForCenter(workCenter); track trackByWorkOrderId(workOrder)) {
          <app-work-order-bar
            [workOrder]="workOrder"
            [left]="getBarLeft(workOrder)"
            [width]="getBarWidth(workOrder)"
            (edit)="onEditWorkOrder($event)"
            (delete)="onDeleteWorkOrder($event)"
          />
        }
      </div>
    }
  </div>
</div>
